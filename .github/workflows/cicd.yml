name: Deploying Backend

on:
    push:
        branches:
            main
            
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Source
              uses: actions/checkout@v4
            - name: Login to Docker Hub
              run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin            
            - name: Builds Docker Image
              run: docker build -t jashan1096/backend-vellura .
            - name: Publish Image to Docker Hub
              run: docker push jashan1096/backend-vellura:latest
    
    deploy: 
        needs: build
        runs-on: self-hosted
        steps:
            - name: Pull image from docker hub
              run: docker pull jashan1096/backend-vellura:latest
            - name: Run docker container
              run: docker run -d -p 8000:8000 --name backend-vellura -e MONGO_PASSWORD='${{secrets.MONGO_PASSWORD}}' jashan1096/backend-vellura

            